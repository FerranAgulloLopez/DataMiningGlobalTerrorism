---
pdf_document: default
author: "Team 2 Group 11"
output:
  html_document:
    df_print: paged
  pdf_document: default
  word_document: default
title: "Bivariate statistical analysis of relevant variables"
header-includes:
- \usepackage{lscape}
- \newcommand{\blandscape}{\begin{landscape}}
- \newcommand{\elandscape}{\end{landscape}}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Installing of necessary packages:

```{r, warning=FALSE}
if(!require(plotly))install.packages("plotly"); require(plotly)
```

Loading dataset:

```{r}
# PONER EL PATH RELATIVO !!!
mydata = read.csv("../../primera_entrega/datasets/preprocessed_dataset.csv")

```

#### attacktype1_txt / success

First we want to analyze if there is a dependence between the variables attacktype1_txt and success.
For that we make a table with values of these two variables.

```{r}
summary(mydata$attacktype1_txt)
summary(mydata$success)

aux = table(mydata$attacktype1_txt,mydata$success);

SuccessRate=numeric(8);
for (x in 1:8) {
  aux2=aux[x,2]/(aux[x,1]+aux[x,2]);
  SuccessRate[x]=aux2;
}
t <- cbind(aux,SuccessRate);
print(t)
```

And then we do the chi-square test, to check if there is a dependency between this two variables or not.

```{r}
chisq.test(aux)
```

With a p-value of 2.2e-16 we can reject this test's null hypothesis and conclude this variables are in fact dependent.

Now we want to analyze with grafical representation the relationship there is between the number of successfull terrorist attack (success == TRUE) and the type of attack it was.

```{r}
success_attacks <- mydata[mydata$success == 'TRUE',]

f<-table(success_attacks$attacktype1_txt)
f1=as.data.frame(f)

# Pie Chart Basic
slices <- f1[2]
lbls1 <- f1[1]
pct <- round(slices/sum(slices)*100)
lbls1 <- paste(lbls1[,"Var1"], pct[,"Freq"])
lbls1 <- paste(lbls1,"%",sep="") # ad % to labels
pie(slices[,"Freq"],labels = lbls1, col=rainbow(length(lbls1)),
   main="Pie Chart of % success attakcs for each attacktype1_txt")

# Pie Chart con Plotly
library(plotly)
plot_ly(f1, labels = ~Var1, values = ~Freq, type = 'pie') %>%
  layout(title = 'Pie Chart of % success attakcs for each attacktype1_txt',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

```

#### weaptype1_txt / success

First we want to analyze if there is a dependence between the variables weaptype1_txt and success.
For that we make a table with values of these two variables.

```{r}
summary(mydata$weaptype1_txt)
summary(mydata$success)

aux = table(mydata$weaptype1_txt,mydata$success);

SuccessRate=numeric(11);
for (x in 1:11) {
  aux2=aux[x,2]/(aux[x,1]+aux[x,2]);
  SuccessRate[x]=aux2;
}
t <- cbind(aux,SuccessRate);
print(t)
```

And then we do the chi-square test, to check if there is a dependency between this two variables or not.

```{r}
chisq.test(aux)
```


With a p-value of 2.2e-16 we can reject this test's null hypothesis and conclude this variables are in fact dependent.

Now we want to analyze with grafical representation the relationship there is between the number of successfull terrorist attack (success == TRUE) and the type of weapon used in it.

```{r}
success_attacks <- mydata[mydata$success == 'TRUE',]

f<-table(success_attacks$weaptype1_txt)
f1=as.data.frame(f)

# Pie Chart Basic
slices <- f1[2]
lbls1 <- f1[1]
pct <- round(slices/sum(slices)*100)
lbls1 <- paste(lbls1[,"Var1"], pct[,"Freq"])
lbls1 <- paste(lbls1,"%",sep="") # ad % to labels
pie(slices[,"Freq"],labels = lbls1, col=rainbow(length(lbls1)),
   main="Pie Chart of % success attakcs for each attacktype1_txt")

# Pie Chart con Plotly
library(plotly)
# HACER QUE NO SE VEA RECORTADO!!! 
plot_ly(f1, labels = ~Var1, values = ~Freq, type = 'pie') %>%
  layout(title = 'Pie Chart of % success attakcs for each weaptype1_txt',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

```

#### targtype1_txt / provstate

```{r}
summary(mydata$targtype1_txt);
summary(mydata$provstate);

aux = table(mydata$provstate,mydata$targtype1_txt);
print(aux)

chisq.test(aux)
```

With a p-value of 2.2e-16 we can reject this test's null hypothesis and conclude this variables are in fact dependent. 



#### targtype1_txt / success

```{r}
summary(mydata$targtype1_txt)
summary(mydata$success)

aux = table(mydata$targtype1_txt ,mydata$success)
print(aux)
chisq.test(aux)
```

With a p-value of 2.704e-05 we can reject this test's null hypothesis and conclude this variables are in fact dependent. 

#### nperpcap / claimmode_txt

```{r}

aux = table(mydata$claimmode_txt, mydata$nperpcap)
aux = as.data.frame(aux)
mat = matrix(aux[,"Freq"],9,11,FALSE,list(unique(aux[,"Var1"]),unique(aux[,"Var2"])))

print(mat)
```

```{r}
rownames(mat) <- c("C-Post","C-Pre","E-mail","Letter","Note", "Other","Pers.","Posted","Video")

boxplot(mat, main = "Boxplot of nperpcap in funtion of claimmode_txt",
        use.cols = FALSE)
# PONERLA BIEN LA LEYENDA!!!
# legend("topleft", c("C-Post: Call (post-incident)", "C-Pre: Call (pre-incident)","E-mail: E-mail","Letter: Letter","Note: Note left at scene","Other: Other", "Pers.: Personal claim", "Posted: Posted to website, blog, etc.", "Video: Video"))
```
#### nperpcap / claimed ???

```{r}
summary(mydata$nperpcap)
summary(mydata$claimed)

aux = table(mydata$nperpcap, mydata$claimed)
aux = as.data.frame(aux)
mat = matrix(aux[,"Freq"],11,2,FALSE,list(unique(aux[,"Var1"]),unique(aux[,"Var2"])))

print(mat)
```
```{r}
boxplot(mat, main = "Boxplot of nperpcap in funtion of claimed",
        use.cols = TRUE)
```

#### weaptype1_txt / nkill
```{r}
summary(mydata$weaptype1_txt)
summary(as.factor(mydata$nkill))
aux = table(mydata$weaptype1_txt, mydata$nkill)
print(aux)
remove <- c(0,44,50,190)
Biologicalkill = mydata$nkill[mydata$weaptype1_txt == 'Biological']
Biologicalkill=Biologicalkill[! Biologicalkill %in% remove]

Chemicalkill = mydata$nkill[mydata$weaptype1_txt == 'Chemical']
Chemicalkill=Chemicalkill[! Chemicalkill %in% remove]

Explosiveskill = mydata$nkill[mydata$weaptype1_txt == 'Explosives']
Explosiveskill=Explosiveskill[! Explosiveskill %in% remove]

FakeWeaponskill = mydata$nkill[mydata$weaptype1_txt == 'Fake Weapons']
FakeWeaponskill=FakeWeaponskill[! FakeWeaponskill %in% remove]

Firearmskill = mydata$nkill[mydata$weaptype1_txt == 'Firearms']
Firearmskill[! Firearmskill %in% remove]

Incendiarykill = mydata$nkill[mydata$weaptype1_txt == 'Incendiary']
Incendiarykill=Incendiarykill[! Incendiarykill %in% remove]

Meleekill = mydata$nkill[mydata$weaptype1_txt == 'Melee']
Meleekill=Meleekill[! Meleekill %in% remove]

Otherkill = mydata$nkill[mydata$weaptype1_txt == 'Other']
Otherkill=Otherkill[! Otherkill %in% remove]

Radiologicalkill = mydata$nkill[mydata$weaptype1_txt == 'Radiological']
Radiologicalkill=Radiologicalkill[! Radiologicalkill %in% remove]

SabotageEquipmentkill = mydata$nkill[mydata$weaptype1_txt == 'Sabotage Equipment']
SabotageEquipmentkill=SabotageEquipmentkill[! SabotageEquipmentkill %in% remove]

Vehiclekill = mydata$nkill[mydata$weaptype1_txt == 'Vehicle']
Vehiclekill=Vehiclekill[! Vehiclekill %in% remove]


boxplot(Biologicalkill,Explosiveskill,Firearmskill,Incendiarykill,Meleekill, main = "Boxplot of kills by weapon type",names=c("Biological","Explosives","Firearms","Incendiary","Melee"),
        use.cols = TRUE)
```


#### weaptype1_txt / nwound
```{r}
summary(mydata$weaptype1_txt)
summary(as.factor(mydata$nwound))
aux = table(mydata$weaptype1_txt, mydata$nwound)
print(aux)

Explosiveswound = mydata$nwound[mydata$weaptype1_txt == 'Explosives']
Explosiveswound <- sapply(as.vector(Explosiveswound), function(x) log10(x))
print(Explosiveswound)
Firearmswound = mydata$nwound[mydata$weaptype1_txt == 'Firearms']

Incendiarywound = mydata$nwound[mydata$weaptype1_txt == 'Incendiary']

Meleewound = mydata$nwound[mydata$weaptype1_txt == 'Melee']

boxplot(Explosiveswound,Firearmswound,Incendiarywound,Meleewound, main = "Boxplot of wounded people by weapon type",names=c("Explosives","Firearms","Incendiary","Melee"),
        use.cols = TRUE, col=c("red","yellow","blue","green"),horizontal = TRUE)
```

#### year date / n ยบ acts 

```{r}
class(mydata$date)
mydata$date = as.Date(mydata$date, "%Y-%m-%d")
class(mydata$date)
mydata$year = as.numeric(format(mydata$date, "%Y"))

aux = table(mydata$year)
#dev.off()
x11()
Conf2x2 = matrix(c(1:6), nrow=3, byrow=FALSE)
layout(Conf2x2)
layout.show(6)
barplot(aux[0:47])
barplot(aux[0:10])
barplot(aux[11:20])
barplot(aux[21:29])
barplot(aux[30:39])
barplot(aux[39:47])
x11()
```

#### month / n ยบ acts 

```{r}

class(mydata$date)
mydata$date = as.Date(mydata$date, "%Y-%m-%d")
class(mydata$date)
mydata$month = as.numeric(format(mydata$date, "%m"))

aux = table(mydata$month);

barplot(aux)

```

#### provstate / gname

```{r}
aux = mydata$gname[mydata$provstate == 'California']
aux = table(aux)
aux = as.data.frame(aux)
aux = aux[aux$Freq > 9,]
plot_ly(aux, labels = ~aux, values = ~Freq, type = 'pie')


aux = mydata$gname[mydata$provstate == 'New York']
aux = table(aux)
aux = as.data.frame(aux)
aux = aux[aux$Freq > 9,]
plot_ly(aux, labels = ~aux, values = ~Freq, type = 'pie')


aux = mydata$gname[mydata$provstate == 'Puerto Rico']
aux = table(aux)
aux = as.data.frame(aux)
aux = aux[aux$Freq > 9,]
plot_ly(aux, labels = ~aux, values = ~Freq, type = 'pie')

```

#### gname / provstate

```{r}
aux = mydata$provstate[mydata$gname == 'Anti-Abortion extremists']
aux=table(aux)
aux=as.data.frame(aux)
plot_ly(aux, labels = ~aux, values = ~Freq, type = 'pie')

aux = mydata$provstate[mydata$gname == 'Left-Wing Militants']
aux=table(aux)
aux=as.data.frame(aux)
plot_ly(aux, labels = ~aux, values = ~Freq, type = 'pie')

aux = mydata$provstate[mydata$gname == 'Fuerzas Armadas de Liberacion Nacional (FALN)']
aux=table(aux)
aux=as.data.frame(aux)
plot_ly(aux, labels = ~aux, values = ~Freq, type = 'pie')


aux = table(mydata$gname ,mydata$provstate)
print(aux)
chisq.test(aux)
```


#### Rate of events by state_governor_party in top 3 provstates

```{r}
aux = mydata$state_governor_party[mydata$provstate == 'California']
aux = as.data.frame(table(aux))
aux = aux[aux$Freq > 9,]
aux = aux[aux$Freq < 200,]
plot_ly(aux, labels = ~aux, values = ~Freq, type = 'pie')


aux = mydata$state_governor_party[mydata$provstate == 'New York']
aux = as.data.frame(table(aux))
aux = aux[aux$Freq > 9,]
plot_ly(aux, labels = ~aux, values = ~Freq, type = 'pie')


aux = mydata$state_governor_party[mydata$provstate == 'Puerto Rico']
aux = as.data.frame(table(aux))
aux = aux[aux$Freq > 9,]
plot_ly(aux, labels = ~aux, values = ~Freq, type = 'pie')

```


#### success (Rate) / president_party

```{r}
success = mydata$president_party[mydata$success == TRUE]
fail = mydata$president_party[mydata$success == FALSE]
success = as.data.frame(table(success))
fail = as.data.frame(table(fail))
s = success[2]+fail[2]
ts = 100*success[2]/s
tf = 100*fail[2]/s

b=data.frame(Rate=c("Success","Fail"),Freq = c(ts[1,1],tf[1,1])) 
View(b)
plot_ly(b, labels = ~b, values = ~Freq, type = 'pie')

```

